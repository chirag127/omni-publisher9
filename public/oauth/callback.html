<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>OAuth Callback - Omni-Publisher</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                    Roboto, "Helvetica Neue", Arial, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .container {
                background: white;
                border-radius: 12px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                max-width: 600px;
                width: 100%;
                padding: 40px;
            }

            h1 {
                color: #333;
                margin-bottom: 10px;
                font-size: 28px;
            }

            .status {
                display: inline-block;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 14px;
                font-weight: 600;
                margin-bottom: 24px;
            }

            .status.success {
                background: #d4edda;
                color: #155724;
            }

            .status.error {
                background: #f8d7da;
                color: #721c24;
            }

            p {
                color: #666;
                line-height: 1.6;
                margin-bottom: 20px;
            }

            .token-container {
                background: #f8f9fa;
                border: 2px solid #e9ecef;
                border-radius: 8px;
                padding: 20px;
                margin: 20px 0;
                position: relative;
            }

            .label {
                font-size: 12px;
                font-weight: 600;
                color: #666;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 8px;
            }

            #token {
                font-family: "Courier New", monospace;
                font-size: 14px;
                color: #333;
                word-break: break-all;
                line-height: 1.5;
                margin: 0;
            }

            .copy-btn {
                margin-top: 16px;
                background: #667eea;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                width: 100%;
            }

            .copy-btn:hover {
                background: #5568d3;
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            }

            .copy-btn:active {
                transform: translateY(0);
            }

            .copy-btn.copied {
                background: #28a745;
            }

            .instructions {
                background: #fff3cd;
                border-left: 4px solid #ffc107;
                padding: 16px;
                border-radius: 4px;
                margin-top: 24px;
            }

            .instructions h3 {
                color: #856404;
                font-size: 16px;
                margin-bottom: 8px;
            }

            .instructions ol {
                color: #856404;
                padding-left: 20px;
                margin: 0;
            }

            .instructions li {
                margin: 4px 0;
            }

            code {
                background: #e9ecef;
                padding: 2px 6px;
                border-radius: 3px;
                font-family: "Courier New", monospace;
                font-size: 13px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üîê OAuth Authorization</h1>
            <span id="status" class="status">Processing...</span>

            <p id="message">
                Extracting access token from authorization response...
            </p>

            <div
                class="token-container"
                id="tokenContainer"
                style="display: none"
            >
                <div class="label">Access Token</div>
                <pre id="token">Extracting token...</pre>
                <button class="copy-btn" id="copyBtn" onclick="copyToken()">
                    üìã Copy Token
                </button>
            </div>

            <div class="instructions">
                <h3>üìù Next Steps:</h3>
                <ol>
                    <li>Copy the access token above</li>
                    <li>Open your <code>.env</code> file</li>
                    <li>Set <code>WORDPRESS_TOKEN=your_token_here</code></li>
                    <li>
                        For GitHub Actions, add it to
                        <strong>Repository Secrets</strong>
                    </li>
                    <li>Do not commit the token to your repository</li>
                </ol>
            </div>
        </div>

        <script>
            function extractToken() {
                // Extract token from URL fragment (#access_token=...)
                const hash = window.location.hash.substring(1);
                const params = new URLSearchParams(hash);

                const token = params.get("access_token");
                const error = params.get("error");
                const errorDescription = params.get("error_description");

                const statusEl = document.getElementById("status");
                const messageEl = document.getElementById("message");
                const tokenContainer =
                    document.getElementById("tokenContainer");
                const tokenEl = document.getElementById("token");

                if (error) {
                    // Error case
                    statusEl.textContent = "‚ùå Authorization Failed";
                    statusEl.className = "status error";
                    messageEl.textContent = `Error: ${
                        errorDescription || error
                    }`;
                    messageEl.style.color = "#721c24";
                } else if (token) {
                    // Success case
                    statusEl.textContent = "‚úÖ Authorization Successful";
                    statusEl.className = "status success";
                    messageEl.textContent =
                        "Your WordPress.com access token has been successfully generated!";

                    tokenContainer.style.display = "block";
                    tokenEl.textContent = token;
                } else {
                    // No token or error found
                    statusEl.textContent = "‚ö†Ô∏è No Token Found";
                    statusEl.className = "status error";
                    messageEl.innerHTML = `
                    No access token was found in the URL. This could mean:<br><br>
                    ‚Ä¢ You navigated to this page directly (use the OAuth authorization URL instead)<br>
                    ‚Ä¢ The authorization process was cancelled<br>
                    ‚Ä¢ There was an issue with the OAuth flow
                `;
                }
            }

            function copyToken() {
                const token = document.getElementById("token").textContent;
                const copyBtn = document.getElementById("copyBtn");

                navigator.clipboard
                    .writeText(token)
                    .then(() => {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = "‚úÖ Copied!";
                        copyBtn.className = "copy-btn copied";

                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                            copyBtn.className = "copy-btn";
                        }, 2000);
                    })
                    .catch((err) => {
                        alert(
                            "Failed to copy token. Please select and copy manually."
                        );
                    });
            }

            // Run on page load
            extractToken();
        </script>
    </body>
</html>
